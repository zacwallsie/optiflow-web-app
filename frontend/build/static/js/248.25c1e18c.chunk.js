"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[248],{18456:(e,n,o)=>{o.d(n,{Z:()=>u});var l=o(64554),t=o(20890),a=o(80043),r=o(43504),s=o(93517),i=o(80184);function c(e){let{links:n,activeLast:o=!1,...a}=e;const r=n[n.length-1].name,c=n.map((e=>(0,i.jsx)(d,{link:e},e.name))),u=n.map((e=>(0,i.jsx)("div",{children:e.name!==r?(0,i.jsx)(d,{link:e}):(0,i.jsx)(t.Z,{variant:"body2",sx:{maxWidth:260,overflow:"hidden",whiteSpace:"nowrap",color:"text.disabled",textOverflow:"ellipsis"},children:r})},e.name)));return(0,i.jsx)(s.Z,{separator:(0,i.jsx)(l.Z,{component:"span",sx:{width:4,height:4,borderRadius:"50%",bgcolor:"text.disabled"}}),...a,children:o?c:u})}function d(e){let{link:n}=e;const{href:o,name:t,icon:s}=n;return(0,i.jsxs)(a.Z,{variant:"body2",component:r.rU,to:o||"#",sx:{lineHeight:2,display:"flex",alignItems:"center",color:"text.primary","& > div":{display:"inherit"}},children:[s&&(0,i.jsx)(l.Z,{sx:{mr:1,"& svg":{width:20,height:20}},children:s}),t]},t)}function u(e){let{links:n,action:o,heading:r,moreLink:s=[],sx:d,...u}=e;return(0,i.jsxs)(l.Z,{sx:{mb:5,...d},children:[(0,i.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsxs)(l.Z,{sx:{flexGrow:1},children:[(0,i.jsx)(t.Z,{variant:"h4",gutterBottom:!0,children:r}),(0,i.jsx)(c,{links:n,...u})]}),o&&(0,i.jsx)(l.Z,{sx:{flexShrink:0},children:o})]}),(0,i.jsx)(l.Z,{sx:{mt:2},children:"string"===typeof s?(0,i.jsx)(a.Z,{href:s,target:"_blank",rel:"noopener",variant:"body2",children:s}):s.map((e=>(0,i.jsx)(a.Z,{noWrap:!0,href:e,variant:"body2",target:"_blank",rel:"noopener",sx:{display:"table"},children:e},e)))})]})}},78248:(e,n,o)=>{o.r(n),o.d(n,{default:()=>se});var l=o(72791),t=o(91614),a=o(64554),r=o(16871),s=o(89731),i=o(98246),c=o(25212),d=o(18456),u=o(13400),h=o(2101),x=o(85860),m=o(43896),p=o(31976),f=o(23786),b=o(5289),j=o(65661),Z=o(39157),v=o(20890),g=o(97123),C=o(36151),w=o(48550),k=o(42419),y=o(52898),S=o(80184);function D(e){let{Tables:n,onTableSelect:o}=e;const{enqueueSnackbar:t}=(0,i.Ds)(),{siloId:c}=(0,r.UO)(),[d,D]=(0,l.useState)([]),[R,T]=(0,l.useState)(0),[F,U]=(0,l.useState)(null),[I,N]=(0,l.useState)(null),[_,A]=(0,l.useState)(null),[E,H]=(0,l.useState)(!1),[O,B]=(0,l.useState)(""),[P,q]=(0,l.useState)(!1);l.useEffect((()=>{n&&D(n)}),[n]);const M=(0,l.useCallback)(((e,n)=>{T(n),d&&d.length>n&&o(d[n])}),[d,o]),W=()=>{U(null),A(null),H(!1),q(!1)};return(0,S.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(u.Z,{onClick:()=>{const e="Table".concat(d.length+1);s.Z.post("/api/v1/silos/".concat(c,"/tables/"),{table_name:e}).then((n=>{const l=[...d,e];D(l),T(l.length-1),o(e)})).catch((e=>{console.error("Error creating table:",e),t("Failed to Create Table - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})}))},disableRipple:!0,children:(0,S.jsx)(k.Z,{})}),(0,S.jsx)(u.Z,{onClick:e=>{A(e.currentTarget)},disableRipple:!0,disabled:0===d.length,children:(0,S.jsx)(y.Z,{})}),(0,S.jsx)(h.Z,{value:R,onChange:M,variant:"scrollable",scrollButtons:!0,sx:{["& .".concat(x.Z.scrollButtons)]:{"&.Mui-disabled":{opacity:.3}}},children:d.map(((e,n)=>(0,S.jsx)(m.Z,{label:e,onContextMenu:e=>((e,n)=>{e.preventDefault(),N(n),U(null===F?{mouseX:e.clientX-2,mouseY:e.clientY+4}:null)})(e,n),disableRipple:!0},e)))}),(0,S.jsxs)(p.Z,{open:null!==F,onClose:W,anchorReference:"anchorPosition",anchorPosition:null!==F?{top:F.mouseY,left:F.mouseX}:void 0,children:[(0,S.jsx)(f.Z,{onClick:()=>{W(),q(!0)},children:"Remove"}),(0,S.jsx)(f.Z,{onClick:()=>{W(),H(!0),B(d[I])},children:"Rename"})]}),(0,S.jsx)(p.Z,{open:Boolean(_),onClose:W,anchorEl:_,PaperProps:{style:{maxHeight:"20vh",overflow:"auto"}},children:d.map(((e,n)=>(0,S.jsx)(f.Z,{onClick:()=>(e=>{T(e),W()})(n),disableRipple:!0,children:e},e)))}),(0,S.jsxs)(b.Z,{open:P,onClose:W,children:[(0,S.jsx)(j.Z,{children:"Confirm Deletion"}),(0,S.jsx)(Z.Z,{children:(0,S.jsx)(v.Z,{children:"Are you sure you want to delete this table?"})}),(0,S.jsxs)(g.Z,{children:[(0,S.jsx)(C.Z,{onClick:W,children:"Cancel"}),(0,S.jsx)(C.Z,{onClick:()=>{const e=d[I];s.Z.delete("/api/v1/silos/".concat(c,"/tables/").concat(e)).then((e=>{const n=d.filter(((e,n)=>n!==I));D(n),T(Math.min(R,n.length-1)),o(d[R])})).catch((e=>{console.error("Error deleting table:",e),t("Failed to Delete Table - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})})),W()},color:"error",children:"Delete"})]})]}),(0,S.jsxs)(b.Z,{open:E,onClose:W,children:[(0,S.jsx)(j.Z,{children:"Rename Table"}),(0,S.jsx)(Z.Z,{children:(0,S.jsx)(w.Z,{autoFocus:!0,margin:"normal",id:"name",type:"text",fullWidth:!0,autoComplete:"off",variant:"standard",value:O,onChange:e=>B(e.target.value)})}),(0,S.jsxs)(g.Z,{children:[(0,S.jsx)(C.Z,{onClick:W,children:"Cancel"}),(0,S.jsx)(C.Z,{onClick:()=>{const e=d[I];s.Z.patch("/api/v1/silos/".concat(c,"/tables/").concat(e,"/"),{table_name:O}).then((e=>{const n=d.map(((e,n)=>n===I?O:e));D(n),H(!1)})).catch((e=>{console.error("Error renaming table:",e.detail||e),t("Failed to Rename Table - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})}))},children:"Save"})]})]})]})}var R=o(34265),T=o(91330),F=o(89e3),U=o(45168),I=o(98822),N=o(27247),_=o(66934),A=o(12065),E=o(68096),H=o(94925),O=o(58406),B=o(79012),P=o(85523),q=o(94454),M=o(56125),W=o(61134),G=o(61265),L=o(81724);const V=["bigint","boolean","date","integer","numeric","real","smallint","text","timestamp","uuid","varchar"],X=L.Ry({columnName:L.Z_().required("Column name is required"),dataType:L.Z_().required("Data type is required"),defaultVal:L.Z_(),checkConstraint:L.Z_(),createIndex:L.O7(),collation:L.Z_()});const Y=function(e){var n;let{open:o,handleClose:t,tableName:a,siloId:r}=e;const{enqueueSnackbar:c}=(0,i.Ds)(),{register:d,handleSubmit:u,control:h,formState:{errors:x},reset:m}=(0,W.cI)({resolver:(0,G.X)(X),defaultValues:{columnName:"",dataType:V[0],defaultVal:"",checkConstraint:"",createIndex:!1,collation:""}}),[p,v]=l.useState(!1);return(0,S.jsxs)(b.Z,{open:o,onClose:()=>{t(),m()},children:[(0,S.jsxs)(j.Z,{children:["Add New Column to ",a]}),(0,S.jsxs)("form",{onSubmit:u((async e=>{s.Z.post("/api/v1/silos/".concat(r,"/tables/").concat(a,"/columns/"),e).then((e=>{console.log("Column added successfully:",e.data),t()})).catch((e=>{console.error("Error fetching table names:",e),c("Failed to Add Column - "+((null===e||void 0===e?void 0:e.detail)||"Unknown Error"),{variant:"error",autoHideDuration:4e3})}))})),children:[(0,S.jsxs)(Z.Z,{children:[(0,S.jsx)(w.Z,{autoFocus:!0,margin:"dense",id:"columnName",label:"Column Name *",type:"text",fullWidth:!0,autoComplete:"off",error:!!x.columnName,helperText:null===(n=x.columnName)||void 0===n?void 0:n.message,...d("columnName")}),(0,S.jsxs)(E.Z,{fullWidth:!0,margin:"dense",error:!!x.dataType,children:[(0,S.jsx)(H.Z,{id:"data-type-label",children:"Data Type *"}),(0,S.jsx)(W.Qr,{name:"dataType",control:h,render:e=>{let{field:n,fieldState:{error:o}}=e;return(0,S.jsx)(O.Z,{...n,labelId:"data-type-label",id:"data-type-select",label:"Data Type",MenuProps:{PaperProps:{style:{maxHeight:200}}},error:!!o,children:V.map((e=>(0,S.jsx)(f.Z,{value:e,children:e},e)))})}}),x.dataType&&(0,S.jsx)("p",{style:{color:"#f44336",margin:"3px 14px",fontSize:"0.75rem"},children:x.dataType.message})]}),(0,S.jsxs)(B.Z,{children:[(0,S.jsx)(P.Z,{control:(0,S.jsx)(q.Z,{...d("isUnique")}),label:"Unique"}),(0,S.jsx)(P.Z,{control:(0,S.jsx)(q.Z,{...d("isNullable")}),label:"Nullable"})]}),(0,S.jsx)(C.Z,{onClick:()=>{v(!p)},color:"primary",sx:{marginTop:"20px"},children:p?"Hide Advanced Options":"Show Advanced Options"}),(0,S.jsxs)(M.Z,{in:p,children:[(0,S.jsx)(w.Z,{margin:"dense",id:"default-value",label:"Default Value",type:"text",fullWidth:!0,autoComplete:"off",...d("defaultVal")}),(0,S.jsx)(w.Z,{margin:"dense",id:"check-constraint",label:"Check Constraint",type:"text",autoComplete:"off",fullWidth:!0,...d("checkConstraint")}),(0,S.jsx)(P.Z,{control:(0,S.jsx)(q.Z,{...d("createIndex")}),label:"Create Index"}),(0,S.jsx)(w.Z,{margin:"dense",id:"collation",label:"Collation",type:"text",fullWidth:!0,autoComplete:"off",...d("collation")})]})]}),(0,S.jsxs)(g.Z,{children:[(0,S.jsx)(C.Z,{onClick:()=>{t(),m()},color:"primary",children:"Cancel"}),(0,S.jsx)(C.Z,{type:"submit",color:"primary",children:"Add Column"})]})]})]})};var z=o(84395),Q=o(34663);const J=(0,_.ZP)(z.Z)((e=>{let{theme:n}=e;return{top:"auto",bottom:0,height:"65px"}})),K=(0,_.ZP)(Q.Z)((e=>{let{theme:n}=e;return{justifyContent:"flex-end",paddingRight:n.spacing(2)}}));function $(e){let{open:n,onConfirm:o,onCancel:l}=e;return n?(0,S.jsx)(J,{position:"fixed",color:"default",children:(0,S.jsxs)(K,{children:[(0,S.jsx)(a.Z,{sx:{flexGrow:1}}),(0,S.jsx)(C.Z,{sx:{marginLeft:1},onClick:o,children:"Confirm Added Row"}),(0,S.jsx)(C.Z,{sx:{marginLeft:1},onClick:l,children:"Remove Added Row"})]})}):null}const ee=(0,_.ZP)(z.Z)((e=>{let{theme:n}=e;return{top:"auto",bottom:0,height:"65px"}})),ne=(0,_.ZP)(Q.Z)((e=>{let{theme:n}=e;return{justifyContent:"flex-end",paddingRight:n.spacing(2)}}));function oe(e){let{open:n,onConfirm:o,onCancel:l}=e;return n?(0,S.jsx)(ee,{position:"fixed",color:"default",children:(0,S.jsxs)(ne,{children:[(0,S.jsx)(a.Z,{sx:{flexGrow:1}}),(0,S.jsx)(C.Z,{sx:{marginLeft:1},onClick:o,children:"Confirm Changes"}),(0,S.jsx)(C.Z,{sx:{marginLeft:1},onClick:l,children:"Cancel Changes"})]})}):null}const le=function(e){let{open:n,handleClose:o,columns:t,tableName:a,siloId:r}=e;const{enqueueSnackbar:c}=(0,i.Ds)(),[d,u]=l.useState("");return(0,S.jsxs)(b.Z,{open:n,onClose:()=>o(!1),"aria-labelledby":"delete-column-dialog-title",children:[(0,S.jsx)(j.Z,{id:"delete-column-dialog-title",children:"Delete Column"}),(0,S.jsxs)(Z.Z,{dividers:!0,children:[(0,S.jsxs)(v.Z,{gutterBottom:!0,children:["Select a column to delete from ",(0,S.jsx)("strong",{children:a}),". This action cannot be undone."]}),(0,S.jsxs)(E.Z,{fullWidth:!0,margin:"normal",children:[(0,S.jsx)(H.Z,{id:"delete-column-select-label",children:"Column"}),(0,S.jsx)(O.Z,{labelId:"delete-column-select-label",id:"delete-column-select",value:d,onChange:e=>u(e.target.value),label:"Column",children:t.map((e=>(0,S.jsx)(f.Z,{value:e.field,children:e.headerName},e.field)))})]})]}),(0,S.jsxs)(g.Z,{children:[(0,S.jsx)(C.Z,{onClick:()=>o(!1),color:"primary",children:"Cancel"}),(0,S.jsx)(C.Z,{onClick:async()=>{s.Z.delete("/api/v1/silos/".concat(r,"/tables/").concat(a,"/columns/").concat(d,"/")).then((e=>{c("Column Deleted Successfully",{variant:"success"}),u(""),o(!0)})).catch((e=>{console.error("Error deleting column -",e),c("Failed to Delete Column - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3}),o(!1)}))},color:"secondary",disabled:!d,children:"Delete"})]})]})},te=(0,_.ZP)(C.Z)((e=>{let{theme:n}=e;return{margin:n.spacing(1)}}));function ae(e){let{onAddRow:n,onOpenColumnDialog:o,onOpenDeleteColumnDialog:l,disableToolBarButtons:t,onDeleteRows:a,selectedRowCount:r}=e;return(0,S.jsxs)(R.D,{children:[(0,S.jsx)(T.Zh,{printOptions:{disableToolbarButton:!0}}),(0,S.jsx)(F.M,{}),(0,S.jsx)(te,{onClick:o,color:"secondary",variant:"contained",disabled:t,children:"Add Column"}),(0,S.jsx)(te,{onClick:l,color:"secondary",variant:"contained",disabled:t,children:"Remove Column"}),(0,S.jsx)(te,{onClick:n,color:"secondary",variant:"contained",disabled:t,children:"Add Row"}),r>0&&(0,S.jsx)(u.Z,{onClick:a,color:"error",children:(0,S.jsx)(N.Z,{})})]})}function re(e){let{selectedTableName:n}=e;const{enqueueSnackbar:o}=(0,i.Ds)(),{siloId:t}=(0,r.UO)(),[a,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(null),[h,x]=(0,l.useState)([]),[m,p]=(0,l.useState)(!1),[f,b]=(0,l.useState)(!1),[j,Z]=l.useState(!1),[v,g]=l.useState(!1),[C,w]=l.useState(!1),[k,y]=(0,l.useState)([]),D=l.useRef({unsavedRows:{},rowsBeforeChange:{}}),R=(0,U.A)(),T=async e=>{(async e=>{s.Z.get("/api/v1/silos/".concat(t,"/tables/").concat(e,"/rows/")).then((e=>{c(e.data.rows)})).catch((e=>{console.error("Error fetching table names:",e),o("Failed to Fetch Table Rows - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})}))})(e),(async e=>{s.Z.get("/api/v1/silos/".concat(t,"/tables/").concat(e,"/columns/")).then((e=>{const n=e.data.columns.map((e=>({...e,editable:"id"!==e.field})));x(n)})).catch((e=>{console.error("Error fetching table columns:",e),o("Failed to Fetch Table Columns - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})}))})(e)};l.useEffect((()=>{n&&T(n)}),[n]);const F=null!=d,N=()=>p(!0),_=()=>{Z(!0)},E=()=>{const e={id:a.length+1,...h.reduce(((e,n)=>("id"!==n.field&&(e[n.field]=""),e)),{})};u(e),c([...a,e]),b(!0)},H=async()=>{k.length>0&&(w(!0),s.Z.post("/api/v1/silos/".concat(t,"/tables/").concat(n,"/rows/batch/delete/"),{row_ids:k}).then((e=>{c(a.filter((e=>!k.includes(e.id)))),y([]),o("Rows Deleted Successfully!",{variant:"success"})})).catch((e=>{console.error("Error deleting silos:",e),o("Failed to Delete Rows - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})})).finally((()=>{w(!1)})))};return(0,S.jsxs)("div",{style:{height:"100%",width:"100%"},children:[(0,S.jsx)(I._,{rows:a,columns:h,apiRef:R,checkboxSelection:!0,getRowId:e=>e.id,disableSelectionOnClick:!0,processRowUpdate:(e,n)=>{const o=e.id;return D.current.unsavedRows[o]=e,D.current.rowsBeforeChange[o]||(D.current.rowsBeforeChange[o]=n),g(Object.keys(D.current.unsavedRows).length>0),e},ignoreValueFormatterDuringExport:!0,onSelectionModelChange:e=>{y(e)},sx:{"& .MuiDataGrid-columnHeaders":{textTransform:"none"},"& .MuiDataGrid-columnHeaderTitle":{textTransform:"none"},"& .MuiDataGrid-row.row--removed":{backgroundColor:e=>"light"===e.palette.mode?"rgba(255, 170, 170, 0.3)":(0,A._j)("rgba(255, 170, 170, 1)",.7)},"& .MuiDataGrid-row.row--edited":{backgroundColor:e=>"light"===e.palette.mode?"rgba(255, 254, 176, 0.3)":(0,A._j)("rgba(255, 254, 176, 1)",.6)},backgroundColor:"background.default"},components:{Toolbar:()=>(0,S.jsx)(ae,{onAddRow:E,onOpenColumnDialog:N,onOpenDeleteColumnDialog:_,disableToolBarButtons:F,onDeleteRows:H,selectedRowCount:k.length})},loading:C,getRowClassName:e=>{let{id:n}=e;const o=D.current.unsavedRows[n];return o?"delete"===o._action?"row--removed":"row--edited":""}}),(0,S.jsx)(Y,{open:m,handleClose:function(){p(!1),T(n)},tableName:n,siloId:t}),(0,S.jsx)($,{open:f,onConfirm:async()=>{w(!0),s.Z.post("/api/v1/silos/".concat(t,"/tables/").concat(n,"/rows/"),{columns:d}).then((e=>{u(null),b(!1),w(!1),o("Row Added Successfully!",{variant:"success"})})).catch((e=>{console.error("Error adding rows:",e),o("Failed to Add Rows - "+((null===e||void 0===e?void 0:e.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3}),w(!1)}))},onCancel:()=>{c(a.filter((e=>e.id!==d.id))),u(null),b(!1)}}),v&&(0,S.jsx)(oe,{open:v,onConfirm:async()=>{const e=Object.values(D.current.unsavedRows);w(!0);try{await s.Z.patch("/api/v1/silos/".concat(t,"/tables/").concat(n,"/rows"),{rows:e.map((e=>({id:e.id,columns:{...e}})))}),o("Rows Updated Successfully",{variant:"success"}),g(!1),D.current={unsavedRows:{},rowsBeforeChange:{}},b(!1),w(!1)}catch(r){var l,a;o("Failed to update rows - "+((null===(l=r.response)||void 0===l||null===(a=l.data)||void 0===a?void 0:a.detail)||"Unknown error"),{variant:"error"}),w(!1)}},onCancel:()=>{R.current.updateRows(Object.values(D.current.rowsBeforeChange)),D.current={unsavedRows:{},rowsBeforeChange:{}},g(!1)}}),(0,S.jsx)(le,{open:j,handleClose:e=>{Z(!1),e&&T(n)},columns:h,tableName:n,siloId:t})]})}function se(){const{enqueueSnackbar:e}=(0,i.Ds)(),{siloId:n}=(0,r.UO)(),[o,u]=(0,l.useState)([]),[h,x]=(0,l.useState)([]),[m,p]=(0,l.useState)("");return(0,l.useEffect)((()=>{var o;o=n,s.Z.get("/api/v1/silos/".concat(o)).then((e=>{u(e.data)})).catch((n=>{console.error("Error fetching silo details:",n),e("Failed to Fetch Silo: "+((null===n||void 0===n?void 0:n.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})})),(n=>{s.Z.get("/api/v1/silos/".concat(n,"/tables/")).then((e=>{x(e.data.tables),e.data.tables.length&&!m&&p(e.data.tables[0])})).catch((n=>{console.error("Error fetching table names:",n),e("Failed to Fetch Tables - "+((null===n||void 0===n?void 0:n.detail)||"Unknown error"),{variant:"error",autoHideDuration:4e3})}))})(n)}),[n]),(0,S.jsxs)(c.Z,{title:o.silo_name||"OptiFlow",children:[(0,S.jsx)(t.Z,{maxWidth:"false",children:(0,S.jsx)(d.Z,{heading:o.silo_name||"Data Silo",links:[{name:"All Silos",href:"/flow/silos"},...o.silo_name?[{name:o.silo_name,href:"",isActive:!0}]:[]]})}),(0,S.jsxs)(a.Z,{display:"flex",flexDirection:"column",height:"86vh",children:[(0,S.jsx)(a.Z,{flex:1,sx:{overflow:"auto"},children:(0,S.jsx)(re,{selectedTableName:m})}),(0,S.jsx)(a.Z,{height:"50px",width:"100%",children:(0,S.jsx)(D,{Tables:h,onTableSelect:p})})]})]})}}}]);
//# sourceMappingURL=248.25c1e18c.chunk.js.map